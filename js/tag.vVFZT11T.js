import{ad as e,ae as l,c as t,e as a,a4 as i,w as s,Q as o,ah as m,l as r,a3 as d,t as n,ac as c,O as u,P as h,aB as p,au as b}from"./index.fjkLwUVu.js";import{v as g}from"./el-loading.DGjIZa5s.js";import{_ as f}from"./FileImage.CNK6_fwR.js";import"./el-scrollbar.DAmtYv6U.js";import{_}from"./index.uvQ3DMPv.js";import{E as y,a as v}from"./el-table-column.CcJDJdsG.js";import"./el-checkbox.Bx2MqeyX.js";import"./el-tooltip.l0sNRNKZ.js";import"./el-popper.DZg10sPd.js";import{E as k}from"./el-link.Ds1J_vSa.js";import{a as V,E as w}from"./el-select.Dphl92Bb.js";import{E as S}from"./el-dialog.BQ-7T3N1.js";import{E as j,a as C}from"./el-form-item.LUBrM-X2.js";import{E as x}from"./el-switch.CZooYmGS.js";import{E as q}from"./el-text.BpgAV3tu.js";import D from"./TagImport.D6z-Kma9.js";import T from"./TagExport.CGbh-e55.js";import{E as U}from"./el-row.CR2lAonX.js";import{E as I}from"./el-col.Asb1dzXh.js";import{E as Q}from"./el-date-picker.CuOHw7o_.js";import{s as E}from"./screen-height.CaLnsKT6.js";import{a as R}from"./index.DKis4amu.js";import{g as A}from"./settings.BkEO_yzR.js";import{l as $,a as P,b as O,c as G,m as L,d as z,f as Y,g as F}from"./tag.D3dQ5Gfy.js";import{_ as M}from"./_plugin-vue_export-helper.BCo6x5W8.js";import{E as N}from"./index.CC5uJ0zJ.js";import"./el-avatar.CztSEU-_.js";import"./el-image-viewer.CKIWDlAT.js";import"./index.BAnbBVvD.js";import"./strings.BFjoWW54.js";import"./index.Ca7HhsrZ.js";import"./index.CZvH84Pk.js";import"./FilePreview.ysv9CpFr.js";/* empty css                          */import"./el-progress.C11kH2od.js";import"./cloneDeep.CpzyAp_h.js";import"./isEqual.C9MgJhLZ.js";import"./_Uint8Array.BeplMWlC.js";import"./el-card.DQc9Ri4s.js";/* empty css                       */import"./permission.6opTfbBv.js";import"./group.Dp74GP4K.js";import"./tag.C6qLWou5.js";import"./index.D1QADgj8.js";import"./index.BIv6f7sb.js";import"./raf.CCooGNZO.js";import"./castArray.BF9loTbA.js";import"./refs.A9PVpu8F.js";import"./el-tab-pane.BAi5YHW8.js";import"./el-table-v2.nF-zXTfY.js";import"./tagsView.DWSC-EGY.js";const H={class:"app-container"};const B=M({name:"MemberTag",components:{Pagination:_,TagExport:T,TagImport:D},data:()=>({name:"会员标签",height:680,loading:!1,idkey:"tag_id",exps:[{exp:"like",name:"包含"}],query:{page:1,limit:A(),search_field:"tag_name",search_exp:"like",date_field:"create_time"},data:[],count:0,dialog:!1,dialogTitle:"",model:{tag_id:"",tag_name:"",tag_desc:"",remark:"",sort:250},rules:{tag_name:[{required:!0,message:"请输入名称",trigger:"blur"}]},selection:[],selectIds:"",selectTitle:"操作",selectDialog:!1,selectType:"",is_disable:0,memberPk:"member_id",memberName:"会员",memberDialog:!1,memberDialogTitle:"",memberLoad:!1,memberData:[],memberCount:0,memberQuery:{page:1,limit:A(),search_field:"nickname",search_exp:"like",search_value:""},memberSelection:[],memberSelectIds:"",memberSelectTitle:"操作",memberSelectDialog:!1,memberSelectType:""}),created(){this.height=E(),this.list()},methods:{list(){this.loading=!0,$(this.query).then((e=>{this.data=e.data.list,this.count=e.data.count,this.exps=e.data.exps,this.loading=!1})).catch((()=>{this.loading=!1}))},add(){this.dialog=!0,this.dialogTitle=this.name+"添加",this.reset()},edit(e){this.dialog=!0,this.dialogTitle=this.name+"修改："+e[this.idkey];var l={};l[this.idkey]=e[this.idkey],P(l).then((e=>{this.reset(e.data)})).catch((()=>{}))},cancel(){this.dialog=!1,this.reset()},submit(){this.$refs.ref.validate((l=>{l&&(this.loading=!0,this.model[this.idkey]?O(this.model).then((l=>{this.list(),this.dialog=!1,e.success(l.msg)})).catch((()=>{this.loading=!1})):G(this.model).then((l=>{this.list(),this.dialog=!1,e.success(l.msg)})).catch((()=>{this.loading=!1})))}))},reset(e){if(this.model=e||this.$options.data().model,void 0!==this.$refs.ref)try{this.$refs.ref.resetFields(),this.$refs.ref.clearValidate()}catch(l){}},search(){this.query.page=1,this.list()},refresh(){const e=this.query.limit;this.query=this.$options.data().query,this.$refs.table.clearSort(),this.query.limit=e,this.list()},sort(e){this.query.sort_field=e.prop,this.query.sort_value="","ascending"===e.order&&(this.query.sort_value="asc",this.list()),"descending"===e.order&&(this.query.sort_value="desc",this.list())},select(e){this.selection=e,this.selectIds=this.selectGetIds(e).toString()},selectGetIds(e){return R(e,this.idkey)},selectAlert(){l.alert("请选择需要操作的"+this.name,"提示",{type:"warning",callback:()=>{}})},selectOpen(e,l=""){if(l){this.$refs.table.clearSelection();const e=l.length;for(let t=0;t<e;t++)this.$refs.table.toggleRowSelection(l[t],!0)}this.selection.length?(this.selectTitle="操作","removem"===e?this.selectTitle=this.name+"解除会员":"disable"===e?this.selectTitle=this.name+"是否禁用":"dele"===e&&(this.selectTitle=this.name+"删除"),this.selectDialog=!0,this.selectType=e):this.selectAlert()},selectCancel(){this.selectDialog=!1},selectSubmit(){if(this.selection.length){const e=this.selectType;"removem"===e?this.removem(this.selection):"disable"===e?this.disable(this.selection,!0):"dele"===e&&this.dele(this.selection,!0),this.selectDialog=!1}else this.selectAlert()},removem(l){l.length?(this.loading=!0,L({tag_id:this.selectGetIds(l),member_ids:[]}).then((l=>{this.list(),e.success(l.msg)})).catch((()=>{this.loading=!1}))):this.selectAlert()},disable(l,t=!1){if(l.length){this.loading=!0;var a=l[0].is_disable;t&&(a=this.is_disable),z({ids:this.selectGetIds(l),is_disable:a}).then((l=>{this.list(),e.success(l.msg)})).catch((()=>{this.list()}))}else this.selectAlert()},dele(l){l.length?(this.loading=!0,Y({ids:this.selectGetIds(l)}).then((l=>{this.list(),e.success(l.msg)})).catch((()=>{this.loading=!1}))):this.selectAlert()},memberShow(e){this.memberDialog=!0,this.memberDialogTitle="标签会员："+e.tag_name,this.memberQuery.tag_id=e.tag_id,this.memberQuery.search_value="",this.member()},member(){this.memberLoad=!0,F(this.memberQuery).then((e=>{this.memberData=e.data.list,this.memberCount=e.data.count,this.memberLoad=!1})).catch((()=>{this.memberLoad=!1}))},memberSort(e){this.memberQuery.sort_field=e.prop,this.memberQuery.sort_value="","ascending"===e.order&&(this.memberQuery.sort_value="asc",this.member()),"descending"===e.order&&(this.memberQuery.sort_value="desc",this.member())},memberSelect(e){this.memberSelection=e,this.memberSelectIds=this.memberSelectGetIds(e).toString()},memberSelectGetIds(e){return R(e,this.memberPk)},memberSelectAlert(){l.alert("请选择需要操作的"+this.memberName,"提示",{type:"warning",callback:()=>{}})},memberSelectOpen(e,l=""){l&&(this.$refs.memberRef.clearSelection(),this.$refs.memberRef.toggleRowSelection(l)),this.memberSelection.length?(this.memberSelectTitle="操作","memberRemove"===e&&(this.memberSelectTitle="解除标签"),this.memberSelectDialog=!0,this.memberSelectType=e):this.memberSelectAlert()},memberSelectCancel(){this.memberSelectDialog=!1},memberSelectSubmit(){if(this.memberSelection.length){"memberRemove"===this.memberSelectType&&this.memberRemove(this.memberSelection),this.memberSelectDialog=!1}else this.memberSelectAlert()},memberRemove(l){l.length?(this.memberLoad=!0,L({tag_id:this.memberQuery.tag_id,member_ids:this.memberSelectGetIds(l)}).then((l=>{this.member(),e.success(l.msg)})).catch((()=>{this.memberLoad=!1}))):this.memberSelectAlert()}}},[["render",function(e,l,E,R,A,$){const P=V,O=w,G=p,L=Q,z=b,Y=I,F=U,M=T,B=D,J=q,K=j,W=x,X=C,Z=S,ee=y,le=k,te=v,ae=_,ie=N,se=f,oe=g;return t(),a("div",H,[i(F,null,{default:s((()=>[i(Y,{class:"mb-2"},{default:s((()=>[i(O,{modelValue:A.query.search_field,"onUpdate:modelValue":l[0]||(l[0]=e=>A.query.search_field=e),class:"ya-search-field",placeholder:"查询字段"},{default:s((()=>[i(P,{value:A.idkey,label:"ID"},null,8,["value"]),i(P,{value:"tag_name",label:"名称"}),i(P,{value:"tag_desc",label:"描述"}),i(P,{value:"remark",label:"备注"}),i(P,{value:"is_disable",label:"禁用"})])),_:1},8,["modelValue"]),i(O,{modelValue:A.query.search_exp,"onUpdate:modelValue":l[1]||(l[1]=e=>A.query.search_exp=e),class:"ya-search-exp"},{default:s((()=>[(t(!0),a(o,null,m(A.exps,(e=>(t(),r(P,{key:e.exp,value:e.exp,label:e.name},null,8,["value","label"])))),128))])),_:1},8,["modelValue"]),"is_disable"===A.query.search_field?(t(),r(O,{key:0,modelValue:A.query.search_value,"onUpdate:modelValue":l[2]||(l[2]=e=>A.query.search_value=e),class:"ya-search-value"},{default:s((()=>[i(P,{value:1,label:"是"}),i(P,{value:0,label:"否"})])),_:1},8,["modelValue"])):(t(),r(G,{key:1,modelValue:A.query.search_value,"onUpdate:modelValue":l[3]||(l[3]=e=>A.query.search_value=e),class:"ya-search-value",placeholder:"查询内容",clearable:""},null,8,["modelValue"])),i(O,{modelValue:A.query.date_field,"onUpdate:modelValue":l[4]||(l[4]=e=>A.query.date_field=e),class:"ya-date-field",placeholder:"时间类型"},{default:s((()=>[i(P,{value:"create_time",label:"添加时间"}),i(P,{value:"update_time",label:"修改时间"})])),_:1},8,["modelValue"]),i(L,{modelValue:A.query.date_value,"onUpdate:modelValue":l[5]||(l[5]=e=>A.query.date_value=e),type:"datetimerange",class:"ya-date-value","start-placeholder":"开始日期","end-placeholder":"结束日期","value-format":"YYYY-MM-DD HH:mm:ss","default-time":[new Date(2024,1,1,0,0,0),new Date(2024,1,1,23,59,59)]},null,8,["modelValue","default-time"]),i(z,{type:"primary",title:"查询/刷新",onClick:l[6]||(l[6]=e=>$.search())},{default:s((()=>l[35]||(l[35]=[d("查询")]))),_:1}),i(z,{type:"default",title:"重置查询条件",onClick:l[7]||(l[7]=e=>$.refresh())},{default:s((()=>l[36]||(l[36]=[d("重置")]))),_:1}),i(z,{type:"primary",onClick:l[8]||(l[8]=e=>$.add())},{default:s((()=>l[37]||(l[37]=[d("添加")]))),_:1})])),_:1})])),_:1}),i(F,null,{default:s((()=>[i(Y,null,{default:s((()=>[i(z,{title:"删除",onClick:l[9]||(l[9]=e=>$.selectOpen("dele"))},{default:s((()=>l[38]||(l[38]=[d("删除")]))),_:1}),i(z,{title:"是否禁用",onClick:l[10]||(l[10]=e=>$.selectOpen("disable"))},{default:s((()=>l[39]||(l[39]=[d("禁用")]))),_:1}),i(z,{title:"解除会员",onClick:l[11]||(l[11]=e=>$.selectOpen("removem"))},{default:s((()=>l[40]||(l[40]=[d("解除会员")]))),_:1}),i(M,{query:A.query},null,8,["query"]),i(B)])),_:1})])),_:1}),i(Z,{modelValue:A.selectDialog,"onUpdate:modelValue":l[14]||(l[14]=e=>A.selectDialog=e),title:A.selectTitle,"close-on-click-modal":!1,"close-on-press-escape":!1,top:"20vh"},{footer:s((()=>[i(z,{onClick:$.selectCancel},{default:s((()=>l[41]||(l[41]=[d("取消")]))),_:1},8,["onClick"]),i(z,{type:"primary",onClick:$.selectSubmit},{default:s((()=>l[42]||(l[42]=[d("提交")]))),_:1},8,["onClick"])])),default:s((()=>[i(X,{ref:"selectRef","label-width":"120px"},{default:s((()=>["removem"===A.selectType?(t(),r(K,{key:0,label:"解除会员"},{default:s((()=>[i(J,{size:"default"},{default:s((()=>[d("确定要解除选中的"+n(A.name)+"的会员吗？",1)])),_:1})])),_:1})):"disable"===A.selectType?(t(),r(K,{key:1,label:"是否禁用"},{default:s((()=>[i(W,{modelValue:A.is_disable,"onUpdate:modelValue":l[12]||(l[12]=e=>A.is_disable=e),"active-value":1,"inactive-value":0},null,8,["modelValue"])])),_:1})):"dele"===A.selectType?(t(),r(K,{key:2,label:"删除"},{default:s((()=>[i(J,{size:"default",type:"danger"},{default:s((()=>[d("确定要删除选中的"+n(A.name)+"吗？",1)])),_:1})])),_:1})):c("",!0),i(K,{label:A.name+"ID"},{default:s((()=>[i(G,{modelValue:A.selectIds,"onUpdate:modelValue":l[13]||(l[13]=e=>A.selectIds=e),type:"textarea",rows:18,disabled:""},null,8,["modelValue"])])),_:1},8,["label"])])),_:1},512)])),_:1},8,["modelValue","title"]),u((t(),r(te,{ref:"table",data:A.data,height:A.height,onSortChange:$.sort,onSelectionChange:$.select},{default:s((()=>[i(ee,{type:"selection",width:"42",title:"全选/反选"}),i(ee,{prop:A.idkey,label:"ID",width:"80",sortable:"custom"},null,8,["prop"]),i(ee,{prop:"tag_name",label:"名称","min-width":"160","show-overflow-tooltip":""}),i(ee,{prop:"tag_desc",label:"描述","min-width":"220","show-overflow-tooltip":""}),i(ee,{prop:"remark",label:"备注","min-width":"150","show-overflow-tooltip":""}),i(ee,{prop:"is_disable_name",label:"禁用","min-width":"85",sortable:"custom"}),i(ee,{prop:"sort",label:"排序","min-width":"85",sortable:"custom"}),i(ee,{prop:"create_time",label:"添加时间",width:"165",sortable:"custom"}),i(ee,{prop:"update_time",label:"修改时间",width:"165",sortable:"custom"}),i(ee,{label:"操作",width:"130"},{default:s((e=>[i(le,{type:"primary",class:"mr-1",underline:!1,onClick:l=>$.memberShow(e.row)},{default:s((()=>l[43]||(l[43]=[d(" 会员 ")]))),_:2},1032,["onClick"]),i(le,{type:"primary",class:"mr-1",underline:!1,onClick:l=>$.edit(e.row)},{default:s((()=>l[44]||(l[44]=[d(" 修改 ")]))),_:2},1032,["onClick"]),i(le,{type:"primary",underline:!1,onClick:l=>$.selectOpen("dele",[e.row])},{default:s((()=>l[45]||(l[45]=[d(" 删除 ")]))),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data","height","onSortChange","onSelectionChange"])),[[oe,A.loading]]),u(i(ae,{total:A.count,"onUpdate:total":l[15]||(l[15]=e=>A.count=e),page:A.query.page,"onUpdate:page":l[16]||(l[16]=e=>A.query.page=e),limit:A.query.limit,"onUpdate:limit":l[17]||(l[17]=e=>A.query.limit=e),onPagination:$.list},null,8,["total","page","limit","onPagination"]),[[h,A.count>0]]),i(Z,{modelValue:A.dialog,"onUpdate:modelValue":l[25]||(l[25]=e=>A.dialog=e),title:A.dialogTitle,"close-on-click-modal":!1,"close-on-press-escape":!1,"before-close":$.cancel,top:"5vh"},{footer:s((()=>[i(z,{loading:A.loading,onClick:$.cancel},{default:s((()=>l[46]||(l[46]=[d("取消")]))),_:1},8,["loading","onClick"]),i(z,{loading:A.loading,type:"primary",onClick:$.submit},{default:s((()=>l[47]||(l[47]=[d("提交")]))),_:1},8,["loading","onClick"])])),default:s((()=>[i(ie,{native:"",height:A.height-30},{default:s((()=>[i(X,{ref:"ref",rules:A.rules,model:A.model,"label-width":"100px"},{default:s((()=>[i(K,{label:"名称",prop:"tag_name"},{default:s((()=>[i(G,{modelValue:A.model.tag_name,"onUpdate:modelValue":l[18]||(l[18]=e=>A.model.tag_name=e),placeholder:"请输入名称",clearable:""},null,8,["modelValue"])])),_:1}),i(K,{label:"描述",prop:"tag_desc"},{default:s((()=>[i(G,{modelValue:A.model.tag_desc,"onUpdate:modelValue":l[19]||(l[19]=e=>A.model.tag_desc=e),type:"textarea",autosize:"",placeholder:"请输入描述"},null,8,["modelValue"])])),_:1}),i(K,{label:"备注",prop:"remark"},{default:s((()=>[i(G,{modelValue:A.model.remark,"onUpdate:modelValue":l[20]||(l[20]=e=>A.model.remark=e),placeholder:"请输入备注",clearable:""},null,8,["modelValue"])])),_:1}),i(K,{label:"排序",prop:"sort"},{default:s((()=>[i(G,{modelValue:A.model.sort,"onUpdate:modelValue":l[21]||(l[21]=e=>A.model.sort=e),type:"number"},null,8,["modelValue"])])),_:1}),A.model[A.idkey]?(t(),r(K,{key:0,label:"添加时间",prop:"create_time"},{default:s((()=>[i(G,{modelValue:A.model.create_time,"onUpdate:modelValue":l[22]||(l[22]=e=>A.model.create_time=e),disabled:""},null,8,["modelValue"])])),_:1})):c("",!0),A.model[A.idkey]?(t(),r(K,{key:1,label:"修改时间",prop:"update_time"},{default:s((()=>[i(G,{modelValue:A.model.update_time,"onUpdate:modelValue":l[23]||(l[23]=e=>A.model.update_time=e),disabled:""},null,8,["modelValue"])])),_:1})):c("",!0),A.model.delete_time?(t(),r(K,{key:2,label:"删除时间",prop:"delete_time"},{default:s((()=>[i(G,{modelValue:A.model.delete_time,"onUpdate:modelValue":l[24]||(l[24]=e=>A.model.delete_time=e),disabled:""},null,8,["modelValue"])])),_:1})):c("",!0)])),_:1},8,["rules","model"])])),_:1},8,["height"])])),_:1},8,["modelValue","title","before-close"]),i(Z,{modelValue:A.memberDialog,"onUpdate:modelValue":l[32]||(l[32]=e=>A.memberDialog=e),title:A.memberDialogTitle,"close-on-click-modal":!1,"close-on-press-escape":!1,top:"5vh",width:"70%"},{default:s((()=>[i(F,null,{default:s((()=>[i(Y,null,{default:s((()=>[i(z,{type:"primary",onClick:l[26]||(l[26]=e=>$.memberSelectOpen("memberRemove"))},{default:s((()=>l[48]||(l[48]=[d("解除")]))),_:1}),i(G,{modelValue:A.memberQuery.search_value,"onUpdate:modelValue":l[27]||(l[27]=e=>A.memberQuery.search_value=e),class:"ya-search-value",placeholder:"昵称",clearable:""},null,8,["modelValue"]),i(z,{type:"primary",onClick:l[28]||(l[28]=e=>$.member())},{default:s((()=>l[49]||(l[49]=[d("查询")]))),_:1})])),_:1})])),_:1}),u((t(),r(te,{ref:"memberRef",data:A.memberData,height:A.height-50,onSortChange:$.memberSort,onSelectionChange:$.memberSelect},{default:s((()=>[i(ee,{type:"selection",width:"42",title:"全选/反选"}),i(ee,{prop:A.memberPk,label:"会员ID","min-width":"100",sortable:"custom"},null,8,["prop"]),i(ee,{prop:"avatar_id",label:"头像","min-width":"62"},{default:s((e=>[i(se,{"file-url":e.row.avatar_url,avatar:"",lazy:""},null,8,["file-url"])])),_:1}),i(ee,{prop:"nickname",label:"昵称","min-width":"150",sortable:"custom","show-overflow-tooltip":""}),i(ee,{prop:"username",label:"用户名","min-width":"145",sortable:"custom","show-overflow-tooltip":""}),i(ee,{prop:"phone",label:"手机","min-width":"120",sortable:"custom","show-overflow-tooltip":""}),i(ee,{prop:"email",label:"邮箱","min-width":"180",sortable:"custom","show-overflow-tooltip":""}),i(ee,{prop:"tag_names",label:"标签","min-width":"170","show-overflow-tooltip":""}),i(ee,{prop:"group_names",label:"分组","min-width":"170","show-overflow-tooltip":""}),i(ee,{label:"操作","min-width":"70"},{default:s((e=>[i(le,{type:"primary",underline:!1,onClick:l=>$.memberSelectOpen("memberRemove",e.row)},{default:s((()=>l[50]||(l[50]=[d(" 解除 ")]))),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data","height","onSortChange","onSelectionChange"])),[[oe,A.memberLoad]]),u(i(ae,{total:A.memberCount,"onUpdate:total":l[29]||(l[29]=e=>A.memberCount=e),page:A.memberQuery.page,"onUpdate:page":l[30]||(l[30]=e=>A.memberQuery.page=e),limit:A.memberQuery.limit,"onUpdate:limit":l[31]||(l[31]=e=>A.memberQuery.limit=e),onPagination:$.member},null,8,["total","page","limit","onPagination"]),[[h,A.memberCount>0]])])),_:1},8,["modelValue","title"]),i(Z,{modelValue:A.memberSelectDialog,"onUpdate:modelValue":l[34]||(l[34]=e=>A.memberSelectDialog=e),title:A.memberSelectTitle,"close-on-click-modal":!1,"close-on-press-escape":!1,top:"20vh"},{footer:s((()=>[i(z,{onClick:$.memberSelectCancel},{default:s((()=>l[51]||(l[51]=[d("取消")]))),_:1},8,["onClick"]),i(z,{type:"primary",onClick:$.memberSelectSubmit},{default:s((()=>l[52]||(l[52]=[d("提交")]))),_:1},8,["onClick"])])),default:s((()=>[i(X,{ref:"memberSelectRef","label-width":"120px"},{default:s((()=>["memberRemove"===A.memberSelectType?(t(),r(K,{key:0,label:"标签ID"},{default:s((()=>[i(J,{size:"default"},{default:s((()=>[d(n(A.memberQuery[A.idkey]),1)])),_:1})])),_:1})):c("",!0),i(K,{label:A.memberName+"ID"},{default:s((()=>[i(G,{modelValue:A.memberSelectIds,"onUpdate:modelValue":l[33]||(l[33]=e=>A.memberSelectIds=e),type:"textarea",autosize:"",disabled:""},null,8,["modelValue"])])),_:1},8,["label"])])),_:1},512)])),_:1},8,["modelValue","title"])])}]]);export{B as default};
