import{at as e,ae as l,ad as a,c as t,e as o,a4 as s,w as i,Q as r,ah as d,l as u,a3 as n,t as m,k as p,ac as c,O as h,P as _,aB as f,au as g}from"./index.fjkLwUVu.js";import{v as y}from"./el-loading.DGjIZa5s.js";import"./el-scrollbar.DAmtYv6U.js";import{_ as b}from"./index.Ca7HhsrZ.js";import{_ as V}from"./index.uvQ3DMPv.js";import{E as q,a as v}from"./el-table-column.CcJDJdsG.js";import"./el-checkbox.Bx2MqeyX.js";import"./el-tooltip.l0sNRNKZ.js";import"./el-popper.DZg10sPd.js";import{E as w}from"./el-link.Ds1J_vSa.js";import{a as k,E as j}from"./el-select.Dphl92Bb.js";import{E as x}from"./el-dialog.BQ-7T3N1.js";import{E as U,a as C}from"./el-form-item.LUBrM-X2.js";import{E as D}from"./el-row.CR2lAonX.js";import{E as I}from"./el-col.Asb1dzXh.js";import{E as P}from"./el-date-picker.CuOHw7o_.js";import{E as T}from"./el-radio.zApfy_2f.js";import{s as S}from"./screen-height.CaLnsKT6.js";import{c as E,a as A}from"./index.DKis4amu.js";import{g as $}from"./settings.BkEO_yzR.js";import{_ as Y}from"./_plugin-vue_export-helper.BCo6x5W8.js";import{E as B}from"./index.CC5uJ0zJ.js";import"./isEqual.C9MgJhLZ.js";import"./_Uint8Array.BeplMWlC.js";import"./strings.BFjoWW54.js";import"./index.BIv6f7sb.js";import"./raf.CCooGNZO.js";import"./index.BAnbBVvD.js";import"./castArray.BF9loTbA.js";import"./refs.A9PVpu8F.js";import"./index.D1QADgj8.js";import"./cloneDeep.CpzyAp_h.js";import"./tagsView.DWSC-EGY.js";const G="/admin/system.UserLog/";const O={class:"app-container"},R={class:"c-red"};const H=Y({name:"SystemUserLog",components:{Pagination:V},data:()=>({name:"用户日志",height:680,loading:!1,idkey:"log_id",exps:[{exp:"like",name:"包含"}],query:{page:1,limit:$(),search_field:"user_id",search_exp:"in",date_field:"create_time"},data:[],count:0,dialog:!1,dialogTitle:"",model:{},rules:{},userData:[],menuData:[],menuProps:{checkStrictly:!0,value:"menu_id",label:"menu_name",multiple:!0,emitPath:!1},logTypes:[],selection:[],selectIds:"",selectTitle:"操作",selectDialog:!1,selectType:""}),created(){this.height=S(),this.list()},methods:{clipboard:E,list(){var l;this.loading=!0,(l=this.query,e({url:G+"list",method:"get",params:l})).then((e=>{this.data=e.data.list,this.count=e.data.count,this.userData=e.data.user,this.menuData=e.data.menu,this.logTypes=e.data.log_types,this.exps=e.data.exps,this.loading=!1})).catch((()=>{this.loading=!1}))},info(l){this.dialog=!0,this.dialogTitle=this.name+"详情："+l[this.idkey];var a,t={};t[this.idkey]=l[this.idkey],(a=t,e({url:G+"info",method:"get",params:a})).then((e=>{this.reset(e.data)})).catch((()=>{}))},cancel(){this.dialog=!1,this.reset()},submit(){this.dialog=!1,this.reset()},reset(e){this.model=e||this.$options.data().model},search(){this.query.page=1,this.list()},refresh(){const e=this.query.limit;this.query=this.$options.data().query,this.$refs.table.clearSort(),this.query.limit=e,this.list()},sort(e){this.query.sort_field=e.prop,this.query.sort_value="","ascending"===e.order&&(this.query.sort_value="asc",this.list()),"descending"===e.order&&(this.query.sort_value="desc",this.list())},select(e){this.selection=e,this.selectIds=this.selectGetIds(e).toString()},selectGetIds(e){return A(e,this.idkey)},selectAlert(){l.alert("请选择需要操作的"+this.name,"提示",{type:"warning",callback:()=>{}})},selectOpen(e,l=""){if(l){this.$refs.table.clearSelection();const e=l.length;for(let a=0;a<e;a++)this.$refs.table.toggleRowSelection(l[a],!0)}this.selection.length?(this.selectTitle="操作","dele"===e&&(this.selectTitle=this.name+"删除"),this.selectDialog=!0,this.selectType=e):this.selectAlert()},selectCancel(){this.selectDialog=!1},selectSubmit(){if(this.selection.length){"dele"===this.selectType&&this.dele(this.selection),this.selectDialog=!1}else this.selectAlert()},dele(l){var t;l.length?(this.loading=!0,(t={ids:this.selectGetIds(l)},e({url:G+"dele",method:"post",data:t})).then((e=>{this.list(),a.success(e.msg)})).catch((()=>{this.loading=!1}))):this.selectAlert()},clear(){l.confirm("确定要清空"+this.name+"(查询结果或所有)吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{var l;(l=this.query,e({url:G+"clear",method:"post",data:l})).then((e=>{this.list(),a.success("清空"+this.name+"记录 "+e.data.count+" 条")})).catch((()=>{}))})).catch((()=>{}))},requestParamCopy(){const e=this.$refs.requestParamRef;E(e.textContent)}}},[["render",function(e,l,a,S,E,A){const $=k,Y=j,G=T,H=f,L=P,M=g,z=I,F=D,J=U,K=C,Q=x,N=q,W=w,X=v,Z=V,ee=b,le=B,ae=y;return t(),o("div",O,[s(F,null,{default:i((()=>[s(z,{class:"mb-2"},{default:i((()=>[s(Y,{modelValue:E.query.search_field,"onUpdate:modelValue":l[0]||(l[0]=e=>E.query.search_field=e),class:"ya-search-field",placeholder:"查询字段"},{default:i((()=>[s($,{value:E.idkey,label:"ID"},null,8,["value"]),s($,{value:"user_id",label:"用户"}),s($,{value:"menu_id",label:"菜单"}),s($,{value:"request_ip",label:"请求IP"}),s($,{value:"request_region",label:"请求地区"}),s($,{value:"request_isp",label:"请求ISP"}),s($,{value:"response_code",label:"返回码"}),s($,{value:"response_msg",label:"返回描述"}),s($,{value:"log_type",label:"日志类型"})])),_:1},8,["modelValue"]),s(Y,{modelValue:E.query.search_exp,"onUpdate:modelValue":l[1]||(l[1]=e=>E.query.search_exp=e),class:"ya-search-exp"},{default:i((()=>[(t(!0),o(r,null,d(E.exps,(e=>(t(),u($,{key:e.exp,value:e.exp,label:e.name},null,8,["value","label"])))),128))])),_:1},8,["modelValue"]),"user_id"===E.query.search_field?(t(),u(Y,{key:0,modelValue:E.query.search_value,"onUpdate:modelValue":l[2]||(l[2]=e=>E.query.search_value=e),class:"ya-search-value",placeholder:"用户",clearable:"",filterable:"","collapse-tags":"",multiple:"","allow-create":""},{default:i((()=>[(t(!0),o(r,null,d(E.userData,(e=>(t(),u($,{key:e.user_id,value:e.user_id,label:e.nickname},{default:i((()=>[n(m(e.nickname)+" ("+m(e.username)+") ",1)])),_:2},1032,["value","label"])))),128))])),_:1},8,["modelValue"])):"menu_id"===E.query.search_field?(t(),u(G,{key:1,modelValue:E.query.search_value,"onUpdate:modelValue":l[3]||(l[3]=e=>E.query.search_value=e),class:"ya-search-value",placeholder:"菜单",options:E.menuData,props:E.menuProps,clearable:"",filterable:"","collapse-tags":""},null,8,["modelValue","options","props"])):"log_type"===E.query.search_field?(t(),u(Y,{key:2,modelValue:E.query.search_value,"onUpdate:modelValue":l[4]||(l[4]=e=>E.query.search_value=e),class:"ya-search-value",placeholder:"日志类型",clearable:"",filterable:""},{default:i((()=>[(t(!0),o(r,null,d(E.logTypes,((e,l)=>(t(),u($,{key:l,value:l,label:e},null,8,["value","label"])))),128))])),_:1},8,["modelValue"])):(t(),u(H,{key:3,modelValue:E.query.search_value,"onUpdate:modelValue":l[5]||(l[5]=e=>E.query.search_value=e),class:"ya-search-value",placeholder:"查询内容",clearable:""},null,8,["modelValue"])),s(L,{modelValue:E.query.date_value,"onUpdate:modelValue":l[6]||(l[6]=e=>E.query.date_value=e),type:"datetimerange",class:"ya-date-value","start-placeholder":"开始日期","end-placeholder":"结束日期","value-format":"YYYY-MM-DD HH:mm:ss","default-time":[new Date(2024,1,1,0,0,0),new Date(2024,1,1,23,59,59)]},null,8,["modelValue","default-time"]),s(M,{type:"primary",title:"查询/刷新",onClick:l[7]||(l[7]=e=>A.search())},{default:i((()=>l[32]||(l[32]=[n("查询")]))),_:1}),s(M,{type:"default",title:"重置查询条件",onClick:l[8]||(l[8]=e=>A.refresh())},{default:i((()=>l[33]||(l[33]=[n("重置")]))),_:1})])),_:1})])),_:1}),s(F,null,{default:i((()=>[s(z,null,{default:i((()=>[s(M,{title:"删除选择",onClick:l[9]||(l[9]=e=>A.selectOpen("dele"))},{default:i((()=>l[34]||(l[34]=[n("删除")]))),_:1}),s(M,{title:"删除查询结果",onClick:l[10]||(l[10]=e=>A.clear())},{default:i((()=>l[35]||(l[35]=[n("清空")]))),_:1})])),_:1})])),_:1}),s(Q,{modelValue:E.selectDialog,"onUpdate:modelValue":l[12]||(l[12]=e=>E.selectDialog=e),title:E.selectTitle,"close-on-click-modal":!1,"close-on-press-escape":!1,top:"20vh"},{footer:i((()=>[s(M,{loading:E.loading,onClick:A.selectCancel},{default:i((()=>l[36]||(l[36]=[n("取消")]))),_:1},8,["loading","onClick"]),s(M,{loading:E.loading,type:"primary",onClick:A.selectSubmit},{default:i((()=>l[37]||(l[37]=[n("提交")]))),_:1},8,["loading","onClick"])])),default:i((()=>[s(K,{ref:"selectRef","label-width":"120px"},{default:i((()=>["dele"===E.selectType?(t(),u(J,{key:0},{default:i((()=>[p("span",R,"确定要删除选中的"+m(E.name)+"吗？",1)])),_:1})):c("",!0),s(J,{label:E.name+"ID"},{default:i((()=>[s(H,{modelValue:E.selectIds,"onUpdate:modelValue":l[11]||(l[11]=e=>E.selectIds=e),type:"textarea",autosize:"",disabled:""},null,8,["modelValue"])])),_:1},8,["label"])])),_:1},512)])),_:1},8,["modelValue","title"]),h((t(),u(X,{ref:"table",data:E.data,height:E.height,onSortChange:A.sort,onSelectionChange:A.select},{default:i((()=>[s(N,{type:"selection",width:"42",title:"全选/反选"}),s(N,{prop:E.idkey,label:"ID",width:"80",sortable:"custom"},null,8,["prop"]),s(N,{prop:"user_id",label:"用户ID","min-width":"100","show-overflow-tooltip":""}),s(N,{prop:"nickname",label:"用户昵称","min-width":"100","show-overflow-tooltip":""}),s(N,{prop:"username",label:"用户账号","min-width":"100","show-overflow-tooltip":""}),s(N,{prop:"menu_id",label:"菜单ID","min-width":"100","show-overflow-tooltip":""}),s(N,{prop:"menu_name",label:"菜单名称","min-width":"130","show-overflow-tooltip":""}),s(N,{prop:"menu_url",label:"菜单链接","min-width":"180","show-overflow-tooltip":""}),s(N,{prop:"request_ip",label:"请求IP","min-width":"130","show-overflow-tooltip":""}),s(N,{prop:"request_region",label:"请求地区","min-width":"150","show-overflow-tooltip":""}),s(N,{prop:"request_isp",label:"请求ISP","min-width":"105","show-overflow-tooltip":""}),s(N,{prop:"response_code",label:"返回码","min-width":"80","show-overflow-tooltip":""}),s(N,{prop:"response_msg",label:"返回描述","min-width":"120","show-overflow-tooltip":""}),s(N,{prop:"create_time",label:"请求时间",width:"165",sortable:"custom"}),s(N,{label:"操作",width:"95"},{default:i((e=>[s(W,{type:"primary",class:"mr-1",underline:!1,onClick:l=>A.info(e.row)},{default:i((()=>l[38]||(l[38]=[n(" 详情 ")]))),_:2},1032,["onClick"]),s(W,{type:"primary",underline:!1,onClick:l=>A.selectOpen("dele",[e.row])},{default:i((()=>l[39]||(l[39]=[n(" 删除 ")]))),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data","height","onSortChange","onSelectionChange"])),[[ae,E.loading]]),h(s(Z,{total:E.count,"onUpdate:total":l[13]||(l[13]=e=>E.count=e),page:E.query.page,"onUpdate:page":l[14]||(l[14]=e=>E.query.page=e),limit:E.query.limit,"onUpdate:limit":l[15]||(l[15]=e=>E.query.limit=e),onPagination:A.list},null,8,["total","page","limit","onPagination"]),[[_,E.count>0]]),s(Q,{modelValue:E.dialog,"onUpdate:modelValue":l[31]||(l[31]=e=>E.dialog=e),title:E.dialogTitle,"close-on-click-modal":!1,"close-on-press-escape":!1,"before-close":A.cancel,top:"5vh"},{footer:i((()=>[s(M,{loading:E.loading,onClick:A.cancel},{default:i((()=>l[40]||(l[40]=[n("取消")]))),_:1},8,["loading","onClick"]),s(M,{loading:E.loading,type:"primary",onClick:A.submit},{default:i((()=>l[41]||(l[41]=[n("确定")]))),_:1},8,["loading","onClick"])])),default:i((()=>[s(le,{native:"",height:E.height-30},{default:i((()=>[s(K,{ref:"ref",rules:E.rules,model:E.model,"label-width":"110px"},{default:i((()=>[s(J,{label:"用户ID",prop:"user_id"},{default:i((()=>[s(H,{modelValue:E.model.user_id,"onUpdate:modelValue":l[16]||(l[16]=e=>E.model.user_id=e)},null,8,["modelValue"])])),_:1}),s(J,{label:"用户昵称",prop:"nickname"},{default:i((()=>[s(H,{modelValue:E.model.nickname,"onUpdate:modelValue":l[17]||(l[17]=e=>E.model.nickname=e)},null,8,["modelValue"])])),_:1}),s(J,{label:"用户账号",prop:"username"},{default:i((()=>[s(H,{modelValue:E.model.username,"onUpdate:modelValue":l[18]||(l[18]=e=>E.model.username=e)},null,8,["modelValue"])])),_:1}),s(J,{label:"菜单ID",prop:"menu_id"},{default:i((()=>[s(H,{modelValue:E.model.menu_id,"onUpdate:modelValue":l[19]||(l[19]=e=>E.model.menu_id=e)},null,8,["modelValue"])])),_:1}),s(J,{label:"菜单名称",prop:"menu_name"},{default:i((()=>[s(H,{modelValue:E.model.menu_name,"onUpdate:modelValue":l[20]||(l[20]=e=>E.model.menu_name=e)},null,8,["modelValue"])])),_:1}),s(J,{label:"菜单链接",prop:"menu_url"},{default:i((()=>[s(H,{modelValue:E.model.menu_url,"onUpdate:modelValue":l[21]||(l[21]=e=>E.model.menu_url=e)},null,8,["modelValue"])])),_:1}),s(J,{label:"请求方式",prop:"request_method"},{default:i((()=>[s(H,{modelValue:E.model.request_method,"onUpdate:modelValue":l[22]||(l[22]=e=>E.model.request_method=e)},null,8,["modelValue"])])),_:1}),s(J,{label:"请求IP",prop:"request_ip"},{default:i((()=>[s(H,{modelValue:E.model.request_ip,"onUpdate:modelValue":l[23]||(l[23]=e=>E.model.request_ip=e)},null,8,["modelValue"])])),_:1}),s(J,{label:"请求地区",prop:"request_region"},{default:i((()=>[s(H,{modelValue:E.model.request_region,"onUpdate:modelValue":l[24]||(l[24]=e=>E.model.request_region=e)},null,8,["modelValue"])])),_:1}),s(J,{label:"请求ISP",prop:"request_isp"},{default:i((()=>[s(H,{modelValue:E.model.request_isp,"onUpdate:modelValue":l[25]||(l[25]=e=>E.model.request_isp=e)},null,8,["modelValue"])])),_:1}),s(J,{label:"请求时间",prop:"create_time"},{default:i((()=>[s(H,{modelValue:E.model.create_time,"onUpdate:modelValue":l[26]||(l[26]=e=>E.model.create_time=e)},null,8,["modelValue"])])),_:1}),s(J,{label:"返回码",prop:"response_code"},{default:i((()=>[s(H,{modelValue:E.model.response_code,"onUpdate:modelValue":l[27]||(l[27]=e=>E.model.response_code=e)},null,8,["modelValue"])])),_:1}),s(J,{label:"返回描述",prop:"response_msg"},{default:i((()=>[s(H,{modelValue:E.model.response_msg,"onUpdate:modelValue":l[28]||(l[28]=e=>E.model.response_msg=e),type:"textarea"},null,8,["modelValue"])])),_:1}),s(J,{label:"用户代理",prop:"user_agent"},{default:i((()=>[s(H,{modelValue:E.model.user_agent,"onUpdate:modelValue":l[29]||(l[29]=e=>E.model.user_agent=e),type:"textarea",autosize:""},null,8,["modelValue"])])),_:1}),s(J,{label:"请求参数",prop:"request_param"},{default:i((()=>[s(z,null,{default:i((()=>[s(M,{text:"",type:"primary",title:"复制参数",onClick:l[30]||(l[30]=e=>A.requestParamCopy())},{default:i((()=>[s(ee,{"icon-class":"copy-document"})])),_:1})])),_:1}),p("pre",{ref:"requestParamRef"},m(E.model.request_param),513)])),_:1})])),_:1},8,["rules","model"])])),_:1},8,["height"])])),_:1},8,["modelValue","title","before-close"])])}]]);export{H as default};
