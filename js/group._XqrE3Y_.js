import{ad as e,ae as l,c as t,e as i,a4 as a,w as o,Q as s,ah as d,l as r,a3 as u,k as n,t as c,ac as m,O as p,P as h,aB as f,au as g}from"./index.fjkLwUVu.js";import{v as _}from"./el-loading.DGjIZa5s.js";import{_ as y}from"./FilePreview.ysv9CpFr.js";import"./el-scrollbar.DAmtYv6U.js";import{_ as b}from"./index.uvQ3DMPv.js";import{E as v,a as k}from"./el-table-column.CcJDJdsG.js";import"./el-checkbox.Bx2MqeyX.js";import"./el-tooltip.l0sNRNKZ.js";import"./el-popper.DZg10sPd.js";import{E as V}from"./el-link.Ds1J_vSa.js";import{a as S,E as w}from"./el-select.Dphl92Bb.js";import{E as C}from"./el-dialog.BQ-7T3N1.js";import{E as q,a as j}from"./el-form-item.LUBrM-X2.js";import{E as D}from"./el-switch.CZooYmGS.js";import{E as x}from"./el-row.CR2lAonX.js";import{E as U}from"./el-col.Asb1dzXh.js";import{E as T}from"./el-date-picker.CuOHw7o_.js";import{s as I}from"./screen-height.CaLnsKT6.js";import{a as Q}from"./index.DKis4amu.js";import{g as R}from"./settings.BkEO_yzR.js";import{l as A,i as E,e as $,a as G,f as P,d as O,b as L,c as z}from"./group.Dp74GP4K.js";import{_ as Y}from"./_plugin-vue_export-helper.BCo6x5W8.js";import{E as F}from"./index.CC5uJ0zJ.js";import"./el-image-viewer.CKIWDlAT.js";import"./index.BAnbBVvD.js";import"./strings.BFjoWW54.js";import"./index.Ca7HhsrZ.js";import"./isEqual.C9MgJhLZ.js";import"./_Uint8Array.BeplMWlC.js";import"./index.BIv6f7sb.js";import"./raf.CCooGNZO.js";import"./castArray.BF9loTbA.js";import"./refs.A9PVpu8F.js";import"./tagsView.DWSC-EGY.js";const H={class:"app-container"},M={style:{}},N={class:"c-red"};const B=Y({name:"FileGroup",components:{Pagination:b},data:()=>({name:"文件分组",height:680,loading:!1,idkey:"group_id",exps:[{exp:"like",name:"包含"}],query:{page:1,limit:R(),search_field:"group_name",search_exp:"like",date_field:"create_time"},data:[],count:0,dialog:!1,dialogTitle:"",model:{group_id:"",group_unique:"",group_name:"",group_desc:"",remark:"",sort:250},rules:{group_name:[{required:!0,message:"请输入名称",trigger:"blur"}]},selection:[],selectIds:"",selectTitle:"操作",selectDialog:!1,selectType:"",is_disable:0,filePk:"file_id",fileName:"文件",fileDialog:!1,fileDialogTitle:"",fileLoad:!1,fileData:[],fileCount:0,fileQuery:{page:1,limit:R(),search_field:"file_name",search_exp:"like",search_value:""},fileSelection:[],fileSelectIds:"",fileSelectTitle:"操作",fileSelectDialog:!1,fileSelectType:""}),created(){this.height=I(),this.list()},methods:{list(){this.loading=!0,A(this.query).then((e=>{this.data=e.data.list,this.count=e.data.count,this.exps=e.data.exps,this.loading=!1})).catch((()=>{this.loading=!1}))},add(){this.dialog=!0,this.dialogTitle=this.name+"添加",this.reset()},edit(e){this.dialog=!0,this.dialogTitle=this.name+"修改："+e[this.idkey];var l={};l[this.idkey]=e[this.idkey],E(l).then((e=>{this.reset(e.data)})).catch((()=>{}))},cancel(){this.dialog=!1,this.reset()},submit(){this.$refs.ref.validate((l=>{l&&(this.loading=!0,this.model[this.idkey]?$(this.model).then((l=>{this.list(),this.dialog=!1,e.success(l.msg)})).catch((()=>{this.loading=!1})):G(this.model).then((l=>{this.list(),this.dialog=!1,e.success(l.msg)})).catch((()=>{this.loading=!1})))}))},reset(e){if(this.model=e||this.$options.data().model,void 0!==this.$refs.ref)try{this.$refs.ref.resetFields(),this.$refs.ref.clearValidate()}catch(l){}},search(){this.query.page=1,this.list()},refresh(){const e=this.query.limit;this.query=this.$options.data().query,this.$refs.table.clearSort(),this.query.limit=e,this.list()},sort(e){this.query.sort_field=e.prop,this.query.sort_value="","ascending"===e.order&&(this.query.sort_value="asc",this.list()),"descending"===e.order&&(this.query.sort_value="desc",this.list())},select(e){this.selection=e,this.selectIds=this.selectGetIds(e).toString()},selectGetIds(e){return Q(e,this.idkey)},selectAlert(){l.alert("请选择需要操作的"+this.name,"提示",{type:"warning",callback:()=>{}})},selectOpen(e,l=""){if(l){this.$refs.table.clearSelection();const e=l.length;for(let t=0;t<e;t++)this.$refs.table.toggleRowSelection(l[t],!0)}this.selection.length?(this.selectTitle="操作","removef"===e?this.selectTitle=this.name+"解除文件":"disable"===e?this.selectTitle=this.name+"禁用":"dele"===e&&(this.selectTitle=this.name+"删除"),this.selectDialog=!0,this.selectType=e):this.selectAlert()},selectCancel(){this.selectDialog=!1},selectSubmit(){if(this.selection.length){const e=this.selectType;"removef"===e?this.removef(this.selection):"disable"===e?this.disable(this.selection,!0):"dele"===e&&this.dele(this.selection,!0),this.selectDialog=!1}else this.selectAlert()},removef(l){l.length?(this.loading=!0,P({group_id:this.selectGetIds(l),file_ids:[]}).then((l=>{this.list(),e.success(l.msg)})).catch((()=>{this.loading=!1}))):this.selectAlert()},disable(l,t=!1){if(l.length){this.loading=!0;var i=l[0].is_disable;t&&(i=this.is_disable),O({ids:this.selectGetIds(l),is_disable:i}).then((l=>{this.list(),e.success(l.msg)})).catch((()=>{this.list()}))}else this.selectAlert()},dele(l){l.length?(this.loading=!0,L({ids:this.selectGetIds(l)}).then((l=>{this.list(),e.success(l.msg)})).catch((()=>{this.loading=!1}))):this.selectAlert()},fileShow(e){this.fileDialog=!0,this.fileDialogTitle=this.name+"文件："+e.group_name,this.fileQuery.group_id=e.group_id,this.fileQuery.search_value="",this.file()},file(){this.fileLoad=!0,z(this.fileQuery).then((e=>{this.fileData=e.data.list,this.fileCount=e.data.count,this.fileLoad=!1})).catch((()=>{this.fileLoad=!1}))},fileSort(e){this.fileQuery.sort_field=e.prop,this.fileQuery.sort_value="","ascending"===e.order&&(this.fileQuery.sort_value="asc",this.file()),"descending"===e.order&&(this.fileQuery.sort_value="desc",this.file())},fileSelect(e){this.fileSelection=e,this.fileSelectIds=this.fileSelectGetIds(e).toString()},fileSelectGetIds(e){return Q(e,this.filePk)},fileSelectAlert(){l.alert("请选择需要操作的"+this.fileName,"提示",{type:"warning",callback:()=>{}})},fileSelectOpen(e,l=""){l&&(this.$refs.fileRef.clearSelection(),this.$refs.fileRef.toggleRowSelection(l)),this.fileSelection.length?(this.fileSelectTitle="操作","fileRemove"===e&&(this.fileSelectTitle="解除分组"),this.fileSelectDialog=!0,this.fileSelectType=e):this.fileSelectAlert()},fileSelectCancel(){this.fileSelectDialog=!1},fileSelectSubmit(){if(this.fileSelection.length){"fileRemove"===this.fileSelectType&&this.fileRemove(this.fileSelection),this.fileSelectDialog=!1}else this.fileSelectAlert()},fileRemove(l){l.length?(this.fileLoad=!0,P({group_id:this.fileQuery.group_id,file_ids:this.fileSelectGetIds(l)}).then((l=>{this.file(),e.success(l.msg)})).catch((()=>{this.fileLoad=!1}))):this.fileSelectAlert()}}},[["render",function(e,l,I,Q,R,A){const E=S,$=w,G=f,P=T,O=g,L=U,z=x,Y=q,B=D,J=j,K=C,W=v,Z=V,X=k,ee=b,le=F,te=y,ie=_;return t(),i("div",H,[a(z,null,{default:o((()=>[a(L,{class:"mb-2"},{default:o((()=>[a($,{modelValue:R.query.search_field,"onUpdate:modelValue":l[0]||(l[0]=e=>R.query.search_field=e),class:"ya-search-field",placeholder:"查询字段"},{default:o((()=>[a(E,{value:R.idkey,label:"ID"},null,8,["value"]),a(E,{value:"group_unique",label:"标识"}),a(E,{value:"group_name",label:"名称"}),a(E,{value:"group_desc",label:"描述"}),a(E,{value:"remark",label:"备注"}),a(E,{value:"is_disable",label:"禁用"})])),_:1},8,["modelValue"]),a($,{modelValue:R.query.search_exp,"onUpdate:modelValue":l[1]||(l[1]=e=>R.query.search_exp=e),class:"ya-search-exp"},{default:o((()=>[(t(!0),i(s,null,d(R.exps,(e=>(t(),r(E,{key:e.exp,value:e.exp,label:e.name},null,8,["value","label"])))),128))])),_:1},8,["modelValue"]),"is_disable"===R.query.search_field?(t(),r($,{key:0,modelValue:R.query.search_value,"onUpdate:modelValue":l[2]||(l[2]=e=>R.query.search_value=e),class:"ya-search-value"},{default:o((()=>[a(E,{value:1,label:"是"}),a(E,{value:0,label:"否"})])),_:1},8,["modelValue"])):(t(),r(G,{key:1,modelValue:R.query.search_value,"onUpdate:modelValue":l[3]||(l[3]=e=>R.query.search_value=e),class:"ya-search-value",placeholder:"搜索文件",clearable:""},null,8,["modelValue"])),a($,{modelValue:R.query.date_field,"onUpdate:modelValue":l[4]||(l[4]=e=>R.query.date_field=e),class:"ya-date-field",placeholder:"时间类型"},{default:o((()=>[a(E,{value:"create_time",label:"添加时间"}),a(E,{value:"update_time",label:"修改时间"})])),_:1},8,["modelValue"]),a(P,{modelValue:R.query.date_value,"onUpdate:modelValue":l[5]||(l[5]=e=>R.query.date_value=e),type:"datetimerange",class:"ya-date-value","start-placeholder":"开始日期","end-placeholder":"结束日期","value-format":"YYYY-MM-DD HH:mm:ss","default-time":[new Date(2024,1,1,0,0,0),new Date(2024,1,1,23,59,59)]},null,8,["modelValue","default-time"]),a(O,{type:"primary",title:"查询/刷新",onClick:l[6]||(l[6]=e=>A.search())},{default:o((()=>l[36]||(l[36]=[u("查询")]))),_:1}),a(O,{type:"default",title:"重置查询条件",onClick:l[7]||(l[7]=e=>A.refresh())},{default:o((()=>l[37]||(l[37]=[u("重置")]))),_:1}),a(O,{type:"primary",onClick:l[8]||(l[8]=e=>A.add())},{default:o((()=>l[38]||(l[38]=[u("添加")]))),_:1})])),_:1})])),_:1}),a(z,null,{default:o((()=>[a(L,null,{default:o((()=>[a(O,{title:"删除",onClick:l[9]||(l[9]=e=>A.selectOpen("dele"))},{default:o((()=>l[39]||(l[39]=[u("删除")]))),_:1}),a(O,{title:"是否禁用",onClick:l[10]||(l[10]=e=>A.selectOpen("disable"))},{default:o((()=>l[40]||(l[40]=[u("禁用")]))),_:1}),a(O,{title:"解除文件",onClick:l[11]||(l[11]=e=>A.selectOpen("removef"))},{default:o((()=>l[41]||(l[41]=[u("解除文件")]))),_:1})])),_:1})])),_:1}),a(K,{modelValue:R.selectDialog,"onUpdate:modelValue":l[14]||(l[14]=e=>R.selectDialog=e),title:R.selectTitle,"close-on-click-modal":!1,"close-on-press-escape":!1,top:"20vh"},{footer:o((()=>[a(O,{onClick:A.selectCancel},{default:o((()=>l[42]||(l[42]=[u("取消")]))),_:1},8,["onClick"]),a(O,{type:"primary",onClick:A.selectSubmit},{default:o((()=>l[43]||(l[43]=[u("提交")]))),_:1},8,["onClick"])])),default:o((()=>[a(J,{ref:"selectRef","label-width":"120px"},{default:o((()=>["removef"===R.selectType?(t(),r(Y,{key:0},{default:o((()=>[n("span",M,"确定要解除选中的"+c(R.name)+"的文件吗？",1)])),_:1})):"disable"===R.selectType?(t(),r(Y,{key:1,label:"是否禁用"},{default:o((()=>[a(B,{modelValue:R.is_disable,"onUpdate:modelValue":l[12]||(l[12]=e=>R.is_disable=e),"active-value":1,"inactive-value":0},null,8,["modelValue"])])),_:1})):"dele"===R.selectType?(t(),r(Y,{key:2},{default:o((()=>[n("span",N,"确定要删除选中的"+c(R.name)+"吗？",1)])),_:1})):m("",!0),a(Y,{label:R.name+"ID"},{default:o((()=>[a(G,{modelValue:R.selectIds,"onUpdate:modelValue":l[13]||(l[13]=e=>R.selectIds=e),type:"textarea",autosize:"",disabled:""},null,8,["modelValue"])])),_:1},8,["label"])])),_:1},512)])),_:1},8,["modelValue","title"]),p((t(),r(X,{ref:"table",data:R.data,height:R.height,onSortChange:A.sort,onSelectionChange:A.select},{default:o((()=>[a(W,{type:"selection",width:"42",title:"全选/反选"}),a(W,{prop:R.idkey,label:"ID",width:"80",sortable:"custom"},null,8,["prop"]),a(W,{prop:"group_unique",label:"标识","min-width":"110","show-overflow-tooltip":""}),a(W,{prop:"group_name",label:"名称","min-width":"130","show-overflow-tooltip":""}),a(W,{prop:"group_desc",label:"描述","min-width":"160","show-overflow-tooltip":""}),a(W,{prop:"remark",label:"备注","min-width":"150","show-overflow-tooltip":""}),a(W,{prop:"is_disable_name",label:"禁用","min-width":"85",sortable:"custom"}),a(W,{prop:"sort",label:"排序","min-width":"85",sortable:"custom"}),a(W,{prop:"create_time",label:"添加时间",width:"165",sortable:"custom"}),a(W,{prop:"update_time",label:"修改时间",width:"165",sortable:"custom"}),a(W,{label:"操作",width:"130"},{default:o((e=>[a(Z,{type:"primary",class:"mr-1",underline:!1,onClick:l=>A.fileShow(e.row)},{default:o((()=>l[44]||(l[44]=[u("文件")]))),_:2},1032,["onClick"]),a(Z,{type:"primary",class:"mr-1",underline:!1,onClick:l=>A.edit(e.row)},{default:o((()=>l[45]||(l[45]=[u("修改")]))),_:2},1032,["onClick"]),a(Z,{type:"primary",underline:!1,onClick:l=>A.selectOpen("dele",[e.row])},{default:o((()=>l[46]||(l[46]=[u("删除")]))),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data","height","onSortChange","onSelectionChange"])),[[ie,R.loading]]),p(a(ee,{total:R.count,"onUpdate:total":l[15]||(l[15]=e=>R.count=e),page:R.query.page,"onUpdate:page":l[16]||(l[16]=e=>R.query.page=e),limit:R.query.limit,"onUpdate:limit":l[17]||(l[17]=e=>R.query.limit=e),onPagination:A.list},null,8,["total","page","limit","onPagination"]),[[h,R.count>0]]),a(K,{modelValue:R.dialog,"onUpdate:modelValue":l[26]||(l[26]=e=>R.dialog=e),title:R.dialogTitle,"close-on-click-modal":!1,"close-on-press-escape":!1,"before-close":A.cancel,top:"5vh"},{footer:o((()=>[a(O,{loading:R.loading,onClick:A.cancel},{default:o((()=>l[47]||(l[47]=[u("取消")]))),_:1},8,["loading","onClick"]),a(O,{loading:R.loading,type:"primary",onClick:A.submit},{default:o((()=>l[48]||(l[48]=[u("提交")]))),_:1},8,["loading","onClick"])])),default:o((()=>[a(le,{native:"",height:R.height-30},{default:o((()=>[a(J,{ref:"ref",rules:R.rules,model:R.model,"label-width":"100px"},{default:o((()=>[a(Y,{label:"标识",prop:"group_unique"},{default:o((()=>[a(G,{modelValue:R.model.group_unique,"onUpdate:modelValue":l[18]||(l[18]=e=>R.model.group_unique=e),placeholder:"请输入标识",clearable:""},null,8,["modelValue"])])),_:1}),a(Y,{label:"名称",prop:"group_name"},{default:o((()=>[a(G,{modelValue:R.model.group_name,"onUpdate:modelValue":l[19]||(l[19]=e=>R.model.group_name=e),placeholder:"请输入名称",clearable:""},null,8,["modelValue"])])),_:1}),a(Y,{label:"描述",prop:"group_desc"},{default:o((()=>[a(G,{modelValue:R.model.group_desc,"onUpdate:modelValue":l[20]||(l[20]=e=>R.model.group_desc=e),type:"textarea",autosize:"",placeholder:"请输入描述"},null,8,["modelValue"])])),_:1}),a(Y,{label:"备注",prop:"remark"},{default:o((()=>[a(G,{modelValue:R.model.remark,"onUpdate:modelValue":l[21]||(l[21]=e=>R.model.remark=e),placeholder:"请输入备注",clearable:""},null,8,["modelValue"])])),_:1}),a(Y,{label:"排序",prop:"sort"},{default:o((()=>[a(G,{modelValue:R.model.sort,"onUpdate:modelValue":l[22]||(l[22]=e=>R.model.sort=e),type:"number"},null,8,["modelValue"])])),_:1}),R.model[R.idkey]?(t(),r(Y,{key:0,label:"添加时间",prop:"create_time"},{default:o((()=>[a(G,{modelValue:R.model.create_time,"onUpdate:modelValue":l[23]||(l[23]=e=>R.model.create_time=e),disabled:""},null,8,["modelValue"])])),_:1})):m("",!0),R.model[R.idkey]?(t(),r(Y,{key:1,label:"修改时间",prop:"update_time"},{default:o((()=>[a(G,{modelValue:R.model.update_time,"onUpdate:modelValue":l[24]||(l[24]=e=>R.model.update_time=e),disabled:""},null,8,["modelValue"])])),_:1})):m("",!0),R.model.delete_time?(t(),r(Y,{key:2,label:"删除时间",prop:"delete_time"},{default:o((()=>[a(G,{modelValue:R.model.delete_time,"onUpdate:modelValue":l[25]||(l[25]=e=>R.model.delete_time=e),disabled:""},null,8,["modelValue"])])),_:1})):m("",!0)])),_:1},8,["rules","model"])])),_:1},8,["height"])])),_:1},8,["modelValue","title","before-close"]),a(K,{modelValue:R.fileDialog,"onUpdate:modelValue":l[33]||(l[33]=e=>R.fileDialog=e),title:R.fileDialogTitle,"close-on-click-modal":!1,"close-on-press-escape":!1,top:"5vh",width:"70%"},{default:o((()=>[a(z,null,{default:o((()=>[a(L,null,{default:o((()=>[a(O,{type:"primary",title:"解除",onClick:l[27]||(l[27]=e=>A.fileSelectOpen("fileRemove"))},{default:o((()=>l[49]||(l[49]=[u(" 解除 ")]))),_:1}),a(G,{modelValue:R.fileQuery.search_value,"onUpdate:modelValue":l[28]||(l[28]=e=>R.fileQuery.search_value=e),class:"ya-search-value",placeholder:"名称",clearable:""},null,8,["modelValue"]),a(O,{type:"primary",onClick:l[29]||(l[29]=e=>A.file())},{default:o((()=>l[50]||(l[50]=[u("查询")]))),_:1})])),_:1})])),_:1}),p((t(),r(X,{ref:"fileRef",data:R.fileData,height:R.height-50,onSortChange:A.fileSort,onSelectionChange:A.fileSelect},{default:o((()=>[a(W,{type:"selection",width:"42",title:"全选/反选"}),a(W,{prop:R.filePk,label:"ID",width:"80",sortable:"custom"},null,8,["prop"]),a(W,{prop:"file_url",label:"文件","min-width":"90"},{default:o((e=>[a(te,{file:e.row,lazy:""},null,8,["file"])])),_:1}),a(W,{prop:"file_type_name",label:"类型","min-width":"85",sortable:"custom"}),a(W,{prop:"file_name",label:"名称","min-width":"120",sortable:"custom","show-overflow-tooltip":""}),a(W,{prop:"file_ext",label:"后缀","min-width":"85",sortable:"custom"}),a(W,{prop:"file_size",label:"大小","min-width":"85",sortable:"custom","show-overflow-tooltip":""}),a(W,{prop:"group_name",label:"分组","min-width":"120","show-overflow-tooltip":""}),a(W,{prop:"tag_names",label:"标签","min-width":"130","show-overflow-tooltip":""}),a(W,{prop:"is_disable_name",label:"禁用","min-width":"80",sortable:"custom"}),a(W,{prop:"sort",label:"排序","min-width":"85",sortable:"custom"}),a(W,{label:"操作","min-width":"70"},{default:o((e=>[a(Z,{type:"primary",underline:!1,onClick:l=>A.fileSelectOpen("fileRemove",e.row)},{default:o((()=>l[51]||(l[51]=[u(" 解除 ")]))),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data","height","onSortChange","onSelectionChange"])),[[ie,R.fileLoad]]),p(a(ee,{total:R.fileCount,"onUpdate:total":l[30]||(l[30]=e=>R.fileCount=e),page:R.fileQuery.page,"onUpdate:page":l[31]||(l[31]=e=>R.fileQuery.page=e),limit:R.fileQuery.limit,"onUpdate:limit":l[32]||(l[32]=e=>R.fileQuery.limit=e),onPagination:A.file},null,8,["total","page","limit","onPagination"]),[[h,R.fileCount>0]])])),_:1},8,["modelValue","title"]),a(K,{modelValue:R.fileSelectDialog,"onUpdate:modelValue":l[35]||(l[35]=e=>R.fileSelectDialog=e),title:R.fileSelectTitle,"close-on-click-modal":!1,"close-on-press-escape":!1,top:"20vh","append-to-body":""},{footer:o((()=>[a(O,{onClick:A.fileSelectCancel},{default:o((()=>l[52]||(l[52]=[u("取消")]))),_:1},8,["onClick"]),a(O,{type:"primary",onClick:A.fileSelectSubmit},{default:o((()=>l[53]||(l[53]=[u("提交")]))),_:1},8,["onClick"])])),default:o((()=>[a(J,{ref:"fileSelectRef","label-width":"120px"},{default:o((()=>["fileRemove"===R.fileSelectType?(t(),r(Y,{key:0,label:"分组ID"},{default:o((()=>[n("span",null,c(R.fileQuery[R.idkey]),1)])),_:1})):m("",!0),a(Y,{label:R.fileName+"ID"},{default:o((()=>[a(G,{modelValue:R.fileSelectIds,"onUpdate:modelValue":l[34]||(l[34]=e=>R.fileSelectIds=e),type:"textarea",autosize:"",disabled:""},null,8,["modelValue"])])),_:1},8,["label"])])),_:1},512)])),_:1},8,["modelValue","title"])])}]]);export{B as default};
