import{ad as e,ae as t,c as i,e as s,a4 as l,w as a,Q as r,ah as o,l as h,a3 as d,O as n,P as c,au as p}from"./index.fjkLwUVu.js";import{v as m}from"./el-loading.DGjIZa5s.js";import{_ as g}from"./index.uvQ3DMPv.js";import{E as u,a as b}from"./el-table-column.CcJDJdsG.js";import"./el-checkbox.Bx2MqeyX.js";import"./el-tooltip.l0sNRNKZ.js";import"./el-popper.DZg10sPd.js";import"./el-scrollbar.DAmtYv6U.js";import{E as _}from"./el-link.Ds1J_vSa.js";import{_ as f}from"./FileImage.CNK6_fwR.js";import{a as y,E as j}from"./el-select.Dphl92Bb.js";import{E as v}from"./el-row.CR2lAonX.js";import{E as w}from"./el-col.Asb1dzXh.js";import{c as k}from"./permission.6opTfbBv.js";import{s as x}from"./screen-height.CaLnsKT6.js";import{c as q,a as A}from"./index.DKis4amu.js";import{g as U}from"./settings.BkEO_yzR.js";import{l as D,i as T,e as C,a as I,r as S,b as P,c as $,d as E,f as G,g as V,h as L}from"./member.uE2K3zwp.js";import{_ as M}from"./_plugin-vue_export-helper.BCo6x5W8.js";import"./isEqual.C9MgJhLZ.js";import"./_Uint8Array.BeplMWlC.js";import"./index.CC5uJ0zJ.js";import"./el-form-item.LUBrM-X2.js";import"./castArray.BF9loTbA.js";import"./strings.BFjoWW54.js";import"./index.BIv6f7sb.js";import"./raf.CCooGNZO.js";import"./index.BAnbBVvD.js";import"./el-dialog.BQ-7T3N1.js";import"./refs.A9PVpu8F.js";import"./el-text.BpgAV3tu.js";import"./el-avatar.CztSEU-_.js";import"./el-image-viewer.CKIWDlAT.js";import"./index.Ca7HhsrZ.js";import"./index.CZvH84Pk.js";import"./FilePreview.ysv9CpFr.js";/* empty css                          */import"./el-progress.C11kH2od.js";import"./cloneDeep.CpzyAp_h.js";import"./el-card.DQc9Ri4s.js";import"./el-switch.CZooYmGS.js";/* empty css                       */import"./el-date-picker.CuOHw7o_.js";import"./group.Dp74GP4K.js";import"./tag.C6qLWou5.js";import"./index.D1QADgj8.js";import"./tagsView.DWSC-EGY.js";const O={class:"app-container"};const F=M({name:"Member",components:{Pagination:g},data:()=>({name:"会员",height:680,loading:!1,idkey:"member_id",exps:[{exp:"like",name:"包含"}],query:{page:1,limit:U(),search_field:"nickname",search_exp:"like",date_field:"create_time"},data:[],count:0,dialog:!1,dialogTitle:"",model:{member_id:"",avatar_id:0,avatar_url:"",tag_ids:[],group_ids:[],nickname:"",username:"",password:"",phone:"",email:"",name:"",gender:0,region_id:"",remark:"",sort:250,api_ids:[],thirds:[]},rules:{nickname:[{required:!0,message:"请输入昵称",trigger:"blur"}],username:[{required:!0,message:"请输入用户名",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"}]},genders:[],platforms:[],applications:[],regionData:[],regionProps:{checkStrictly:!0,value:"region_id",label:"region_name",emitPath:!1},regionQueryProps:{checkStrictly:!0,value:"region_id",label:"region_name",multiple:!0,emitPath:!1},tagData:[],groupData:[],selection:[],selectIds:"",selectTitle:"操作",selectDialog:!1,selectType:"",region_id:0,tag_ids:[],group_ids:[],password:"",is_super:0,is_disable:0,apiProps:{label:"api_name",children:"children"},apiCheckAll:!1,apiExpandAll:!1,thirdUnbindDialog:!1,thirdUnbindModel:{},thirdUnbindLoad:!1}),created(){this.height=x(),this.list()},methods:{checkPermission:k,clipboard:q,list(){this.loading=!0,D(this.query).then((e=>{this.data=e.data.list,this.count=e.data.count,this.genders=e.data.genders,this.platforms=e.data.platforms,this.applications=e.data.applications,this.regionData=e.data.region,this.tagData=e.data.tag,this.groupData=e.data.group,this.exps=e.data.exps,this.loading=!1})).catch((()=>{this.loading=!1}))},add(){this.dialog=!0,this.dialogTitle=this.name+"添加",this.reset()},edit(e){this.dialog=!0,this.dialogTitle=this.name+"修改："+e[this.idkey];var t={};t[this.idkey]=e[this.idkey],T(t).then((e=>{this.reset(e.data)})).catch((()=>{}))},cancel(){this.dialog=!1,this.reset()},submit(){this.$refs.ref.validate((t=>{t?(this.loading=!0,this.model.api_tree=[],this.model.thirds=[],this.model[this.idkey]?C(this.model).then((t=>{this.list(),this.dialog=!1,e.success(t.msg)})).catch((()=>{this.loading=!1})):I(this.model).then((t=>{this.list(),this.dialog=!1,e.success(t.msg)})).catch((()=>{this.loading=!1}))):e.error("请完善必填项（带红色星号*）")}))},reset(e){if(this.model=e||this.$options.data().model,this.apiExpandAll=!1,void 0!==this.$refs.ref)try{this.$refs.ref.resetFields(),this.$refs.ref.clearValidate()}catch(t){}},search(){this.query.page=1,this.list()},refresh(){const e=this.query.limit;this.query=this.$options.data().query,this.$refs.table.clearSort(),this.query.limit=e,this.list()},sort(e){this.query.sort_field=e.prop,this.query.sort_value="","ascending"===e.order&&(this.query.sort_value="asc",this.list()),"descending"===e.order&&(this.query.sort_value="desc",this.list())},select(e){this.selection=e,this.selectIds=this.selectGetIds(e).toString()},selectGetIds(e){return A(e,this.idkey)},selectAlert(){t.alert("请选择需要操作的"+this.name,"提示",{type:"warning",callback:()=>{}})},selectOpen(e,t=""){if(t){this.$refs.table.clearSelection();const e=t.length;for(let i=0;i<e;i++)this.$refs.table.toggleRowSelection(t[i],!0)}this.selection.length?(this.selectTitle="操作","region"===e?this.selectTitle=this.name+"修改所在地":"edittag"===e?this.selectTitle=this.name+"修改标签":"editgroup"===e?this.selectTitle=this.name+"修改分组":"repwd"===e?this.selectTitle=this.name+"重置密码":"super"===e?this.selectTitle=this.name+"是否超会":"disable"===e?this.selectTitle=this.name+"是否禁用":"dele"===e&&(this.selectTitle=this.name+"删除"),this.selectDialog=!0,this.selectType=e):this.selectAlert()},selectCancel(){this.selectDialog=!1},selectSubmit(){if(this.selection.length){const e=this.selectType;"region"===e?this.region(this.selection):"edittag"===e?this.edittag(this.selection):"editgroup"===e?this.editgroup(this.selection):"repwd"===e?this.repwd(this.selection):"super"===e?this.issuper(this.selection,!0):"disable"===e?this.disable(this.selection,!0):"dele"===e&&this.dele(this.selection),this.selectDialog=!1}else this.selectAlert()},region(t){t.length?(this.loading=!0,S({ids:this.selectGetIds(t),region_id:this.region_id}).then((t=>{this.list(),e.success(t.msg)})).catch((()=>{this.loading=!1}))):this.selectAlert()},edittag(t){t.length?(this.loading=!0,P({ids:this.selectGetIds(t),tag_ids:this.tag_ids}).then((t=>{this.list(),e.success(t.msg)})).catch((()=>{this.loading=!1}))):this.selectAlert()},editgroup(t){t.length?(this.loading=!0,$({ids:this.selectGetIds(t),group_ids:this.group_ids}).then((t=>{this.list(),e.success(t.msg)})).catch((()=>{this.loading=!1}))):this.selectAlert()},repwd(t){t.length?this.password?(this.loading=!0,E({ids:this.selectGetIds(t),password:this.password}).then((t=>{this.list(),e.success(t.msg)})).catch((()=>{this.loading=!1}))):e.error("请输入新密码"):this.selectAlert()},issuper(t,i=!1){if(t.length){this.loading=!0;var s=t[0].is_super;i&&(s=this.is_super),G({ids:this.selectGetIds(t),is_super:s}).then((t=>{this.list(),e.success(t.msg)})).catch((()=>{this.list()}))}else this.selectAlert()},disable(t,i=!1){if(t.length){this.loading=!0;var s=t[0].is_disable;i&&(s=this.is_disable),V({ids:this.selectGetIds(t),is_disable:s}).then((t=>{this.list(),e.success(t.msg)})).catch((()=>{this.list()}))}else this.selectAlert()},dele(t){t.length?(this.loading=!0,L({ids:this.selectGetIds(t)}).then((t=>{this.list(),e.success(t.msg)})).catch((()=>{this.loading=!1}))):this.selectAlert()},apiExpandAllChange(){const e=this.apiExpandAll,t=this.$refs.apiRef.store._getAllNodes().length;for(let i=0;i<t;i++)this.$refs.apiRef.store._getAllNodes()[i].expanded=e},thirdUnbindBtn(e){this.thirdUnbindDialog=!0,this.thirdUnbindModel=e},thirdUnbindSubmit(){const i=this.thirdUnbindModel;i?(this.thirdUnbindLoad=!0,L({ids:[i.third_id],type:"third"}).then((t=>{var s={};s[this.idkey]=i[this.idkey],T(s).then((e=>{this.model.thirds=e.data.thirds})).catch((()=>{})),this.thirdUnbindLoad=!1,this.thirdUnbindDialog=!1,e.success(t.msg)})).catch((()=>{this.thirdUnbindLoad=!1}))):t.alert("请选择需要操作的"+this.name+"第三方账号","提示",{type:"warning",callback:()=>{}})},thirdDisable(t){var i={};i[this.idkey]=t[this.idkey],V({ids:[t.third_id],is_disable:t.is_disable,type:"third"}).then((t=>{T(i).then((e=>{this.model.thirds=e.data.thirds})).catch((()=>{})),e.success(t.msg)})).catch((()=>{T(i).then((e=>{this.model.thirds=e.data.thirds})).catch((()=>{}))}))}}},[["render",function(e,t,k,x,q,A){const U=y,D=j,T=p,C=w,I=v,S=u,P=f,$=_,E=b,G=g,V=m;return i(),s("div",O,[l(I,null,{default:a((()=>[l(C,{class:"mb-2"},{default:a((()=>[l(D,{modelValue:q.query.search_field,"onUpdate:modelValue":t[0]||(t[0]=e=>q.query.search_field=e),class:"ya-search-field",placeholder:"查询字段"},{default:a((()=>[l(U,{value:q.idkey,label:"ID"},null,8,["value"]),l(U,{value:"nickname",label:"昵称"}),l(U,{value:"username",label:"用户名"}),l(U,{value:"phone",label:"手机"}),l(U,{value:"email",label:"邮箱"}),l(U,{value:"tag_ids",label:"标签"}),l(U,{value:"group_ids",label:"分组"}),l(U,{value:"is_super",label:"超会"}),l(U,{value:"is_disable",label:"禁用"}),l(U,{value:"remark",label:"备注"}),l(U,{value:"name",label:"姓名"}),l(U,{value:"gender",label:"性别"}),l(U,{value:"region_id",label:"所在地"}),l(U,{value:"platform",label:"注册平台"}),l(U,{value:"application",label:"注册应用"})])),_:1},8,["modelValue"]),l(D,{modelValue:q.query.search_exp,"onUpdate:modelValue":t[1]||(t[1]=e=>q.query.search_exp=e),class:"ya-search-exp"},{default:a((()=>[(i(!0),s(r,null,o(q.exps,(e=>(i(),h(U,{key:e.exp,value:e.exp,label:e.name},null,8,["value","label"])))),128))])),_:1},8,["modelValue"]),l(T,{type:"primary",title:"查询/刷新",onClick:t[2]||(t[2]=e=>A.search())},{default:a((()=>t[8]||(t[8]=[d("查询")]))),_:1}),l(T,{type:"default",title:"重置查询条件",onClick:t[3]||(t[3]=e=>A.refresh())},{default:a((()=>t[9]||(t[9]=[d("重置")]))),_:1})])),_:1})])),_:1}),l(I,null,{default:a((()=>[l(C,null,{default:a((()=>[l(T,{title:"添加主题",onClick:t[4]||(t[4]=e=>A.selectOpen("region"))},{default:a((()=>t[10]||(t[10]=[d("添加主题")]))),_:1})])),_:1})])),_:1}),n((i(),h(E,{ref:"table",data:q.data,height:q.height,onSortChange:A.sort,onSelectionChange:A.select},{default:a((()=>[l(S,{type:"selection",width:"42",title:"全选/反选"}),l(S,{prop:q.idkey,label:"ID",width:"80",sortable:"custom"},null,8,["prop"]),l(S,{prop:"avatar_id",label:"头像","min-width":"62"},{default:a((e=>[l(P,{"file-url":e.row.avatar_url,avatar:"",lazy:""},null,8,["file-url"])])),_:1}),l(S,{prop:"nickname",label:"昵称","min-width":"170",sortable:"custom","show-overflow-tooltip":""}),l(S,{prop:"username",label:"用户名","min-width":"170",sortable:"custom","show-overflow-tooltip":""}),l(S,{prop:"phone",label:"手机","min-width":"112",sortable:"custom","show-overflow-tooltip":""}),l(S,{prop:"email",label:"邮箱","min-width":"200",sortable:"custom","show-overflow-tooltip":""}),l(S,{prop:"tag_names",label:"标签","min-width":"130","show-overflow-tooltip":""}),l(S,{prop:"group_names",label:"分组","min-width":"135","show-overflow-tooltip":""}),l(S,{prop:"is_super_name",label:"超会","min-width":"80",sortable:"custom"}),l(S,{prop:"is_disable_name",label:"禁用","min-width":"80",sortable:"custom"}),l(S,{prop:"sort",label:"排序",width:"85",sortable:"custom"}),l(S,{prop:"create_time",label:"注册时间",width:"165",sortable:"custom"}),l(S,{label:"操作",width:"95"},{default:a((e=>[l($,{type:"primary",class:"mr-1",underline:!1,onClick:t=>A.edit(e.row)},{default:a((()=>t[11]||(t[11]=[d(" 修改 ")]))),_:2},1032,["onClick"]),l($,{type:"primary",underline:!1,onClick:t=>A.selectOpen("dele",[e.row])},{default:a((()=>t[12]||(t[12]=[d(" 删除 ")]))),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data","height","onSortChange","onSelectionChange"])),[[V,q.loading]]),n(l(G,{total:q.count,"onUpdate:total":t[5]||(t[5]=e=>q.count=e),page:q.query.page,"onUpdate:page":t[6]||(t[6]=e=>q.query.page=e),limit:q.query.limit,"onUpdate:limit":t[7]||(t[7]=e=>q.query.limit=e),onPagination:A.list},null,8,["total","page","limit","onPagination"]),[[c,q.count>0]])])}]]);export{F as default};
